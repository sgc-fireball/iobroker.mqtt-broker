<html>
<head>
    <link rel="stylesheet" type="text/css" href="../../lib/css/themes/jquery-ui/redmond/jquery-ui.min.css"/>
    <script type="text/javascript" src="../../lib/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../../lib/js/jquery-ui-1.10.3.full.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/adapter.css"/>
    <script type="text/javascript" src="../../js/translate.js"></script>
    <script type="text/javascript" src="../../js/adapter-settings.js"></script>

    <script type="text/javascript">
        var onChange;

        function encrypt(key, value) {
            var result = '';
            for (var i = 0; i < value.length; ++i) {
                result += String.fromCharCode(key[i % key.length].charCodeAt(0) ^ value.charCodeAt(i));
            }
            return result;
        }

        function decrypt(key, value) {
            var result = '';
            for (var i = 0; i < value.length; ++i) {
                result += String.fromCharCode(key[i % key.length].charCodeAt(0) ^ value.charCodeAt(i));
            }
            return result;
        }

        function load(settings, _onChange) {
            onChange = _onChange;
            settings.password = !!settings.password ? decrypt('Zgfr56gFe87jJOM',settings.password) : '';
            Object.keys(settings).forEach((key) => {
                $('#'+key).val(settings[key]);
            });
            $('#password_confirm').val($('#password').val());
            onChange(false);
            $('input[type="text"],input[type="password"]').change(function () {
                onChange();
            }).keyup(function () {
                onChange();
            });
        }

        function getSettings() {
            return {
                port: parseInt($('#port').val()),
                username: $('#username').val(),
                password: $('#password').val(),
                password_confirm: $('#password_confirm').val(),
            };
        }

        function save(callback) {
            var values = getSettings();
            if (values.port < 1 || values.port > 65534) {
                showMessage(_('Please update your port (1-65534).'));
                return;
            }
            if (values.username.length < 8) {
                showMessage(_('Please update your username (min: 8 chars).'));
                return;
            }
            if (values.password.length < 8 || values.password !== values.password_confirm) {
                showMessage(_('Please update your password (min: 8 chars).'));
                return;
            }
            delete values.password_confirm;
            values.password = encrypt('Zgfr56gFe87jJOM', values.password);
            callback(values);
        }
    </script>
</head>
<body>
<div id="adapter-container">
    <table>
        <tr>
            <td style="width: 80%;">
                <table>
                    <tr>
                        <td><label class="translate" for="port">Port:</label></td>
                        <td><input id="port" type="text" size="5" class="value number"/></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><label class="translate" for="user">User:</label></td>
                        <td><input id="user" type="text" size="17" class="value"/></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><label class="translate" for="pass">Password:</label></td>
                        <td><input id="pass" type="password" size="17" class="value"/></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><label class="translate" for="pass_confirm">Password confirmation:</label></td>
                        <td><input id="pass_confirm" type="password" size="17"/></td>
                        <td></td>
                    </tr>
                </table>
            </td>
            <td style="width: 20%;"><img src="mqtt.png"></td>
        </tr>
    </table>
</div>
</body>
</html>